From 1485ab781e27d164e2902e6b9d073e89a3169466 Mon Sep 17 00:00:00 2001
From: Xiao-Long Chen <chenxiaolong@cxl.epac.to>
Date: Sat, 14 Sep 2013 15:36:43 -0400
Subject: [PATCH] I hate Windows with a passion

---
 mkbootimg/mkbootimg.c | 10 +++++++++-
 1 file changed, 9 insertions(+), 1 deletion(-)

diff --git a/mkbootimg/mkbootimg.c b/mkbootimg/mkbootimg.c
index e7c2918..235a190 100644
--- a/mkbootimg/mkbootimg.windows.c
+++ b/mkbootimg/mkbootimg.windows.c
@@ -15,6 +15,14 @@
 ** limitations under the License.
 */
 
+#ifndef O_BINARY
+#  ifdef _O_BINARY
+#    define O_BINARY _O_BINARY
+#  else
+#    define O_BINARY 0
+#  endif
+#endif
+
 #include <stdio.h>
 #include <stdlib.h>
 #include <string.h>
@@ -32,7 +40,7 @@ static void *load_file(const char *fn, unsigned *_sz)
     int fd;
 
     data = 0;
-    fd = open(fn, O_RDONLY);
+    fd = open(fn, O_RDONLY | O_BINARY);
     if(fd < 0) return 0;
 
     sz = lseek(fd, 0, SEEK_END);
-- 
1.8.1.2

